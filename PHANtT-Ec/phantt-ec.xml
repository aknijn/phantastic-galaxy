<tool id="phantt-ec" name="PHANtT-Ec" version="3.0">
    <description>Typing for Escherichia coli</description>
    <requirements>
        <requirement type="package" version="3.10">python</requirement>
        <requirement type="package" version="5.28">perl</requirement>
        <requirement type="package" version="1.7">perl-bioperl</requirement>
        <requirement type="package" version="0.39">trimmomatic</requirement>
        <requirement type="package" version="3.15">spades</requirement>
        <requirement type="package" version="2.5">skesa</requirement>
        <requirement type="package" version="5.1">muscle</requirement>
        <requirement type="package" version="2.5.2">bowtie2</requirement>
        <requirement type="package" version="1.3.1">samtools</requirement>
        <requirement type="package" version="1.3.1">bcftools</requirement>
        <requirement type="package" version="2.23">mlst</requirement>
		<requirement type="package" version="1.0.1">abricate</requirement>
        <requirement type="package" version="2.7.5">fpdf2</requirement>
    </requirements>
    <environment_variables>
        <environment_variable name="HOME">/home/galaxy</environment_variable>
    </environment_variables>
    <!-- basic error handling -->
    <stdio>
        <exit_code range="1:" level="fatal" description="Tool exception" />
    </stdio>
    <command>
<![CDATA[
    #import subprocess
    #set $contamination_str = $subprocess.getoutput('cat ' + str($contamination))
    #if $contamination_str == "No" and $species == "Escherichia coli":
        python
        $__tool_directory__/PHANtT-Ec.py --fasta ${input_fasta} --output $phanttec_json --input_id $input_id --region '$region' --year $year --virulotypes $virulotypes --amrgenes $amrgenes --seqtype $seqtype  --samplereport $samplereport
            #if str( $input_pc.forward.name ) != "dummy.fastq":
                -1 ${input_pc.forward}
                #if str( $input_pc.reverse.name ) != "dummy.fastq":
                    -2 ${input_pc.reverse}
                #end if
            #else
                -1 ${input_pc.reverse}
            #end if
    #else
        touch $phanttec_json
        touch $virulotypes
        touch $amrgenes
        touch $seqtype
		touch $samplereport
    #end if
]]>
    </command>

    <inputs>
        <param name="input_pc" type="data_collection" format="fastqsanger" collection_type="paired" label="Paired-end FASTQ collection" help="Must be of datatype &quot;fastqsanger&quot;" optional="false" />
        <param name="input_fasta" format="fasta" type="data" multiple="true" label="fasta file" />
        <param name="input_id" type="text" label="IRIDA sample code" />
        <param name="region" type="text" label="Sample Region" />
        <param name="year" type="text" label="Sample Year" />
        <param name="species" type="text" label="species name" />
        <param name="contamination" format="txt" type="data" label="Contamination" />
    </inputs>

    <!-- define outputs -->
    <outputs>
        <data name="phanttec_json" format="json" label="${tool.name} on ${on_string}: typing" />
        <data name="virulotypes" format="tabular" label="${tool.name} on ${on_string}: virulotypes" />
        <data name="amrgenes" format="tabular" label="${tool.name} on ${on_string}: amrgenes" />
        <data name="seqtype" format="tabular" label="${tool.name} on ${on_string}: sequence type" />
        <data name="samplereport" format="pdf" label="${tool.name} on ${on_string}: sample report" />
    </outputs>
</tool>
